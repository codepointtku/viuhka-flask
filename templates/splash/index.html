{% extends "splash/forms/base.html" %}
{{ super() }}

{% block meta_extra %}
<!-- Index CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<!-- ./index cdn -->
{% endblock %}

{% block body_content %}
<style>
    label {
        font-weight: bold;
        margin-top: 0.5em
    }
</style>
<div class="row">
    <div class="col">
        <div class="d-flex justify-content-center">
            <h1><img src="{{ url_for('static', filename='viuhka/media/logo.png') }}">Työllisyysviuhka</h1>
        </div>
        <div class="d-flex justify-content-center">
            <p style="border:none;border-bottom:1px solid green;">Työllistymistä edistäviä palveluja Turun alueella</p>
        </div>
    </div>
</div>
<div class="wip">
    <p> Verkkosivustoamme kehitetään.</p>
    <p> Sivuston toiminnassa ja sisällössä esiintyy tämän vuoksi puutteita.</p>
    <p> Puutteet korjataan vaiheittain vuoden 2019 aikana.</p>
</div>
<div class="row">
    <div class="col-md-4" style="box-shadow: 0 5px 3px 0 rgba(0, 0, 0, .1);">
        <div class="row">
            <div class="col">
                <div class="d-flex justify-content-center">
                    <div class="column-title">
                        Valinnat
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <input class="form-control" id="serviceSearch" placeholder="Haku"
                    style="background: transparent;border:none;border-bottom:1px solid green;">
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col">
                <div class="panel-group" id="accordion">
                    {% for category in categories %}
                    {% if category.amount() >= 1 %}
                    <div class="panel panel-default">
                        <div class="panel-heading" style="background-color: #00A97A;">
                            <h4 class="panel-title" style="background-color: #00A97A;">
                                <div class="d-flex justify-content-left font-weight-bold">
                                    <a id="cg_{{ category.category.sanitized() }}" data-toggle="collapse"
                                        data-parent="#accordion" href="#{{ category.category.sanitized() }}"
                                        style="color: white;" categoryId="{{ category.id }}">
                                        {{ category.category.name }}
                                    </a>
                                </div>
                            </h4>
                        </div>
                        <div id="{{ category.category.sanitized() }}" class="panel-collapse collapse">
                            {% for category_item in category.items %}
                            <div class="panel-body">
                                <a style="color: black;" href="javascript:void(0);" id="cgItem_{{ category_item.id }}"
                                    sanitized="{{ category_item.sanitized() }}" cgItemCategoryId={{ category.id }}>
                                    {{ category_item.text }}
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="col" style="box-shadow: 0 5px 3px 0 rgba(0, 0, 0, .1);">
        <div class="row">
            <div class="col">
                <div class="d-flex justify-content-center" style="margin-bottom: 36px;">
                    <h2 class="column-title">
                        Palvelut
                    </h2>
                </div>
                <div id="resultSet" class="col">
                    <div class="row">
                        <p id="results"></p>
                    </div>
                    <div class="row">
                        <a id="resetFilters" href="javascript:void(0);">
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col"
                        style="background: transparent;border:none;border-top:1px solid green;border-bottom:1px solid green;">
                        <table class="table" id="serviceTable">
                            <tbody>
                                {% for service in services %}
                                {% if service.published %}
                                <tr>
                                    <td id="row_{{ service.id }}" class="{{ service.joined_sanitized() }}">
                                        <div class="row">
                                            <div class="col">
                                                <div class="d-flex justify-content-center">
                                                    <div class="col">
                                                        <a href="{{ url_for('index.service', id=service.id) }}">
                                                            <h2>{{ service.name }}</h2>
                                                        </a>
                                                        <p>{{ service.organization }}</p>
                                                        <p>{{ service.ingress }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col">
                <div class="d-flex justify-content-center">
                    <a class="btn btn-primary btn-lg" href="/search" role="button"
                        style="background: #00A97A;border-color: #00A97A;">
                        <i class="fa fa-caret-left"></i>
                        &nbsp; Hakuun
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="d-flex justify-content-center">
                    <a href='#'>Ilmoita virheestä</a>
                </div>
            </div>
            <div class="col">
                <div class="d-flex justify-content-center">
                    {% if current_user.is_staff() %}
                    <a href="{{ url_for('admin.index') }}">Muokkaa palvelun tietoja</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function filter(t) {
        var count = 0;
        t.filter(function () {
            if (!($(this).find('td').attr('style') == 'none')) {
                count += 1;
            }
        });
        return count;
    }

    $(document).ready(function () {
        var rows = $('#serviceTable tr');
        var results = $('#results');

        function filter(t, a) {
            t.forEach(function(i) {
                if (i.toUpperCase() === a.toUpperCase())
                    return true;
            });
            return false;
        }

        setInterval(function () {
            results.text($('td:visible').length + ' tulosta.');
        }, 125);

        $('#serviceSearch').on('keyup', function () {
            var search = $(this).val().toUpperCase();
            for (i = 0; i < rows.length; i++) {
                td = rows[i].getElementsByTagName('td')[0];
                title = td.getElementsByTagName('h2')[0];
                if (~title.innerText.toUpperCase().indexOf(search)) {
                    $(td).show(25);
                } else {
                    $(td).hide(25);
                }
            }
            rows = $('#serviceTable tr');
            $('a[id=resetFilters').text('Poista hakusuodattimet');
            $('a[id=resetFilters').show();
        });

        $('a[id^=cg_').on('click', function () {
            var categoryItems = $('a[cgItemCategoryId^=' + $(this).attr('categoryId') + ']');
            console.log($(categoryItems));
            for (i = 0; i < categoryItems.length; i++) {
                var search = $(categoryItems[i]).attr('sanitized');
                for (j = 0; j < rows.length; j++) {
                    td = rows[i].getElementsByTagName('td')[0];
                    if (td) {
                        if ($.inArray(search, $(td).attr('class').split(' ')) !== -1) {
                            $(td).hide(25);
                        } else {
                            $(td).show(25);
                        }
                    }
                }
                rows = $('#serviceTable tr');
                $('a[id=resetFilters').text('Poista hakusuodattimet');
                $('a[id=resetFilters').show();
            }
        });
        $('a[id^=cgItem_]').on('click', function () {
            var search = $(this).attr('sanitized');
            for (i = 0; i < rows.length; i++) {
                td = rows[i].getElementsByTagName('td')[0];
                if (td) {
                    if (!$(td).hasClass(search)) {
                        $(td).hide(25);
                    } else {
                        $(td).show(25);
                    }
                }
            }
            rows = $('#serviceTable tr');
            $('a[id=resetFilters').text('Poista hakusuodattimet');
            $('a[id=resetFilters').show();

        });
        $('a[id=resetFilters]').on('click', function () {
            $(this).hide();
            var rows = $('#serviceTable tr');
            for (i = 0; i < rows.length; i++) {
                td = rows[i].getElementsByTagName('td')[0];
                if (td) {
                    $(td).show(25);
                }
            }
            $('#serviceSearch').val('');
        });
    });
     $('.panel-collapse').on('show.bs.collapse', function () {
    $(this).siblings('.panel-heading').addClass('active');
  });

  $('.panel-collapse').on('hide.bs.collapse', function () {
    $(this).siblings('.panel-heading').removeClass('active');
  });
</script>
{% endblock %}